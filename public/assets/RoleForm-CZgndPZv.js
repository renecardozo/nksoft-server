import{X as q,u as B,r as n,j as s,W as l}from"./index-Caj9Gai4.js";import{C as I,a as L,b as V}from"./CToaster-BOW1tPlA.js";function G(){const{id:a}=q(),m=B(),x=n.useRef(),[t,d]=n.useState({roleName:"",permissions:[]}),[N,g]=n.useState([]),[c,j]=n.useState({}),[b,u]=n.useState(null),[v,y]=n.useState({id:"",roleName:"",permissions:[]}),C=async()=>{let e=`api/role/${a}`;const r=await l.get(e);console.log(r),d(r)},R=async()=>{const r=await l.get("api/role-permissions");y(r.filter(o=>o.id!==+a))},w=async()=>{const r=await l.get("api/permissions");g(r)},P=async e=>{const o=await l.post("api/create",e);o.success?m("/configurar/roles"):u(h(o.error))},E=async(e,r)=>{let o=`api/editar/${r}`;const i=await l.post(o,e);i.success?m("/configurar/roles"):u(h(i.error))},f=e=>{const{name:r,value:o,type:i,checked:p}=e.target;if(i==="checkbox"){const F=p?[...t.permissions,r]:t.permissions.filter($=>$!==r);d({...t,permissions:F})}else d({...t,[r]:o})},S=(e,r)=>{if(e.length!==r.length)return!1;for(let o=0;o<e.length;o++)if(e[o]!==r[o])return!1;return!0},k=e=>{const r=t.permissions;return S(e.permissions,r)},T=e=>{e.preventDefault();const r={};t.roleName.trim()||(r.roleName="El nombre del rol es requerido"),t.permissions.length||(r.permiso="Seleccione al menos un permiso"),j(r);const o=v.filter(k);if(o.length>0){let i=o.map(p=>p.roleName);u(h("Rol con esos permisos ya existe: "+i))}else Object.keys(r).length===0&&(a?E(t,a):P(t))},D=()=>{m("/configurar/roles")},h=e=>s.jsx(L,{autohide:!0,visible:!0,color:"danger",children:s.jsx(V,{children:e})});return n.useEffect(()=>{a&&C(),w(),R()},[a]),s.jsxs("div",{className:"container",children:[s.jsx(I,{ref:x,push:b,placement:"bottom-end",style:{marginBottom:"50px"}}),s.jsx("h2",{className:"text-center mb-4",children:a?"Editar Role":"Crear Nuevo Rol"}),s.jsxs("form",{onSubmit:T,children:[s.jsx("div",{className:"row",children:s.jsxs("div",{className:"col-md-6",children:[s.jsx("label",{htmlFor:"roleName",className:"form-label",children:"Nombre del Rol"}),s.jsx("input",{type:"text",className:"form-control",id:"roleName",name:"roleName",value:t.roleName,onChange:f}),c.roleName&&s.jsx("div",{className:"text-danger",children:c.roleName})]})}),s.jsx("div",{className:"row mt-3",children:s.jsxs("div",{children:[s.jsx("p",{children:"Permisos:"}),s.jsx("div",{className:"row ",children:N.map(e=>s.jsx("div",{className:"col-md-3 mb-2",children:s.jsxs("div",{className:"form-check",children:[s.jsx("input",{className:"form-check-input",type:"checkbox",id:`${e.name.toLowerCase()}Permission`,name:e.name,checked:t.permissions.includes(e.name),onChange:f}),s.jsx("label",{className:"form-check-label",htmlFor:`${e.name.toLowerCase()}Permission`,children:e.name})]})},e.id))}),c.permiso&&s.jsx("div",{className:"text-danger",children:c.permiso})]})}),s.jsx("div",{className:"row mt-3",children:s.jsxs("div",{className:"col-md-6",children:[s.jsx("button",{type:"submit",className:"btn btn-primary me-5",children:"Guardar"}),s.jsx("button",{className:"btn btn-danger text-light",onClick:D,children:"Cancelar"})]})})]})]})}export{G as default};
