import{X as q,u as B,r as n,j as s,W as l}from"./index-WtevhoQQ.js";import{C as I,a as L,b as V}from"./CToaster-B8Mu9yKV.js";function G(){const{id:a}=q(),m=B(),x=n.useRef(),[o,d]=n.useState({roleName:"",permissions:[]}),[N,g]=n.useState([]),[c,j]=n.useState({}),[b,u]=n.useState(null),[v,y]=n.useState({id:"",roleName:"",permissions:[]}),C=async()=>{let e=`api/role/${a}`;const r=await l.get(e);console.log(r),d(r)},R=async()=>{const r=await l.get("api/role-permissions");y(r.filter(t=>t.id!==+a))},w=async()=>{const r=await l.get("api/permissions");g(r)},P=async e=>{const t=await l.post("api/create",e);t.success?m("/configurar/roles"):u(h(t.error))},E=async(e,r)=>{let t=`api/editar/${r}`;const i=await l.put(t,e);i.success?m("/configurar/roles"):u(h(i.error))},f=e=>{const{name:r,value:t,type:i,checked:p}=e.target;if(i==="checkbox"){const F=p?[...o.permissions,r]:o.permissions.filter($=>$!==r);d({...o,permissions:F})}else d({...o,[r]:t})},S=(e,r)=>{if(e.length!==r.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==r[t])return!1;return!0},k=e=>{const r=o.permissions;return S(e.permissions,r)},T=e=>{e.preventDefault();const r={};o.roleName.trim()||(r.roleName="El nombre del rol es requerido"),o.permissions.length||(r.permiso="Seleccione al menos un permiso"),j(r);const t=v.filter(k);if(t.length>0){let i=t.map(p=>p.roleName);u(h("Rol con esos permisos ya existe: "+i))}else Object.keys(r).length===0&&(a?E(o,a):P(o))},D=()=>{m("/configurar/roles")},h=e=>s.jsx(L,{autohide:!0,visible:!0,color:"danger",children:s.jsx(V,{children:e})});return n.useEffect(()=>{a&&C(),w(),R()},[a]),s.jsxs("div",{className:"container",children:[s.jsx(I,{ref:x,push:b,placement:"bottom-end",style:{marginBottom:"50px"}}),s.jsx("h2",{className:"text-center mb-4",children:a?"Editar Rol":"Crear Nuevo Rol"}),s.jsxs("form",{onSubmit:T,children:[s.jsx("div",{className:"row",children:s.jsxs("div",{className:"col-md-6",children:[s.jsx("label",{htmlFor:"roleName",className:"form-label",children:"Nombre del Rol"}),s.jsx("input",{type:"text",className:"form-control",id:"roleName",name:"roleName",value:o.roleName,onChange:f,disabled:!!a}),c.roleName&&s.jsx("div",{className:"text-danger",children:c.roleName})]})}),s.jsx("div",{className:"row mt-3",children:s.jsxs("div",{children:[s.jsx("p",{children:"Permisos:"}),s.jsx("div",{className:"row ",children:N.map(e=>s.jsx("div",{className:"col-md-3 mb-2",children:s.jsxs("div",{className:"form-check",children:[s.jsx("input",{className:"form-check-input",type:"checkbox",id:`${e.name.toLowerCase()}Permission`,name:e.name,checked:o.permissions.includes(e.name),onChange:f}),s.jsx("label",{className:"form-check-label",htmlFor:`${e.name.toLowerCase()}Permission`,children:e.name})]})},e.id))}),c.permiso&&s.jsx("div",{className:"text-danger",children:c.permiso})]})}),s.jsx("div",{className:"row mt-3",children:s.jsxs("div",{className:"col-md-6",children:[s.jsx("button",{type:"submit",className:"btn btn-primary me-5",children:"Guardar"}),s.jsx("button",{className:"btn btn-danger text-light",onClick:D,children:"Cancelar"})]})})]})]})}export{G as default};
